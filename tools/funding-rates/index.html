<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>交易所资金费率对比</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .positive-rate {
            color: #28a745;
        }
        .negative-rate {
            color: #dc3545;
        }
        .table-container {
            margin-top: 20px;
        }
        .exchange-select {
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="mt-4 mb-4">交易所资金费率对比</h1>
        
        <div class="exchange-select">
            <div class="form-check form-check-inline">
                <input class="form-check-input" type="checkbox" id="binanceCheck" checked>
                <label class="form-check-label" for="binanceCheck">Binance</label>
            </div>
            <div class="form-check form-check-inline">
                <input class="form-check-input" type="checkbox" id="okxCheck" checked>
                <label class="form-check-label" for="okxCheck">OKX</label>
            </div>
        </div>

        <div class="table-container">
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>交易对</th>
                        <th>交易所</th>
                        <th>当前资金费率</th>
                        <th>预测资金费率</th>
                        <th>24h累计费率</th>
                        <th>7天累计费率</th>
                        <th>更新时间</th>
                    </tr>
                </thead>
                <tbody id="ratesTableBody">
                </tbody>
            </table>
        </div>
    </div>

    <script>
        class FundingRateMonitor {
            constructor() {
                this.exchanges = {
                    binance: true,
                    okx: true
                };
                this.data = {};
                this.init();
            }

            init() {
                // 初始化复选框事件监听
                document.getElementById('binanceCheck').addEventListener('change', (e) => {
                    this.exchanges.binance = e.target.checked;
                    this.updateTable();
                });
                document.getElementById('okxCheck').addEventListener('change', (e) => {
                    this.exchanges.okx = e.target.checked;
                    this.updateTable();
                });

                // 开始定期获取数据
                this.fetchData();
                setInterval(() => this.fetchData(), 60000); // 每分钟更新一次
            }

            async fetchData() {
                try {
                    if (this.exchanges.binance) {
                        const binanceData = await this.fetchBinanceRates();
                        this.data.binance = binanceData;
                    }
                    if (this.exchanges.okx) {
                        const okxData = await this.fetchOKXRates();
                        this.data.okx = okxData;
                    }
                    this.updateTable();
                } catch (error) {
                    console.error('获取资金费率失败:', error);
                }
            }

            async fetchBinanceRates() {
                const response = await fetch('https://fapi.binance.com/fapi/v1/premiumIndex');
                const data = await response.json();
                return data.map(item => ({
                    symbol: item.symbol,
                    fundingRate: parseFloat(item.lastFundingRate),
                    nextFundingRate: parseFloat(item.nextFundingRate),
                    timestamp: new Date().toLocaleString()
                }));
            }

            async fetchOKXRates() {
                const response = await fetch('https://www.okx.com/api/v5/public/funding-rate?instType=SWAP');
                const data = await response.json();
                return data.data.map(item => ({
                    symbol: item.instId.replace('-SWAP', ''),
                    fundingRate: parseFloat(item.fundingRate),
                    nextFundingRate: parseFloat(item.nextFundingRate),
                    timestamp: new Date().toLocaleString()
                }));
            }

            updateTable() {
                const tbody = document.getElementById('ratesTableBody');
                tbody.innerHTML = '';

                for (const [exchange, data] of Object.entries(this.data)) {
                    if (!this.exchanges[exchange]) continue;

                    data.forEach(item => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${item.symbol}</td>
                            <td>${exchange.toUpperCase()}</td>
                            <td class="${this.getRateClass(item.fundingRate)}">${(item.fundingRate * 100).toFixed(4)}%</td>
                            <td class="${this.getRateClass(item.nextFundingRate)}">${(item.nextFundingRate * 100).toFixed(4)}%</td>
                            <td>-</td>
                            <td>-</td>
                            <td>${item.timestamp}</td>
                        `;
                        tbody.appendChild(row);
                    });
                }
            }

            getRateClass(rate) {
                return rate > 0 ? 'positive-rate' : rate < 0 ? 'negative-rate' : '';
            }
        }

        // 启动监控器
        document.addEventListener('DOMContentLoaded', () => {
            new FundingRateMonitor();
        });
    </script>
</body>
</html> 